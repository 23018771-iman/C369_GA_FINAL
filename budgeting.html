<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spending Goals - Financefriend</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #fde6e6;
            color: #333;
            margin: 0;
            padding: 0;
        }
        .container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            position: relative;
        }
        .caption {
            text-align: left;
            margin-bottom: 10px;
            width: 100%;
            display: flex;
            align-items: center;
        }
        .caption label {
            font-size: 18px;
            margin-right: 10px;
        }
        .caption select {
            font-size: 18px;
            padding: 10px; 
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #fff;
        }
        .chart-container {
            width: 100%;
            max-width: 600px;
            margin-bottom: 20px;
        }
        .goals-summary {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 350px;
            text-align: left;
            position: absolute;
            top: 20px;
            right: 20px;
        }
        .goals-summary h2 {
            width: 100%;
            font-size: 18px;
            margin-bottom: 10px;
        }
        .goals-summary .form-group {
            margin-bottom: 20px;
        }
        .goals-summary label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        .goals-summary input[type="number"],
        .goals-summary input[type="range"] {
            width: 100%;
        }
        .goals-summary .value {
            display: block;
            text-align: right;
            font-weight: bold;
            font-size: 14px;
        }
        .goals-summary button {
            width: 100%;
            padding: 10px;
            background-color: #f7a8a8;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }
        .goals-summary button:hover {
            background-color: #f27c7c;
        }
        .button-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .return-button {
            background-color: #ff6666;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            text-decoration: none;
            text-align: center;
        }
        .return-button:hover {
            background-color: #cc3333;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="goals-summary">
            <h2>Your Custom Spending Summary</h2>

            <form id="spendingForm">
                <div class="form-group">
                    <label for="totalAmount">Total Amount ($)</label>
                    <input type="number" id="totalAmount" name="totalAmount" min="0" step="any" oninput="updateSpendingValues()" required>
                </div>
                <div class="form-group">
                    <label for="housing">Housing (%)</label>
                    <input type="range" id="housing" name="housing" min="0" max="100" step="1" oninput="updateValue('housing')" required>
                    <span class="value" id="housing-value">30</span>
                </div>
                <div class="form-group">
                    <label for="transportation">Transportation (%)</label>
                    <input type="range" id="transportation" name="transportation" min="0" max="100" step="1" oninput="updateValue('transportation')" required>
                    <span class="value" id="transportation-value">20</span>
                </div>
                <div class="form-group">
                    <label for="food">Food (%)</label>
                    <input type="range" id="food" name="food" min="0" max="100" step="1" oninput="updateValue('food')" required>
                    <span class="value" id="food-value">15</span>
                </div>
                <div class="form-group">
                    <label for="entertainment">Entertainment (%)</label>
                    <input type="range" id="entertainment" name="entertainment" min="0" max="100" step="1" oninput="updateValue('entertainment')" required>
                    <span class="value" id="entertainment-value">10</span>
                </div>
                <div class="form-group">
                    <label for="utilities">Utilities (%)</label>
                    <input type="range" id="utilities" name="utilities" min="0" max="100" step="1" oninput="updateValue('utilities')" required>
                    <span class="value" id="utilities-value">10</span>
                </div>
                <div class="form-group">
                    <label for="other">Other (%)</label>
                    <input type="range" id="other" name="other" min="0" max="100" step="1" oninput="updateValue('other')" required>
                    <span class="value" id="other-value">15</span>
                </div>
                <button type="submit">Update Chart</button>
            </form>
        </div>

        <div class="caption">
            <label for="month">Spending goals for the month of:</label>
            <select id="month" name="month" onchange="loadSpendingData(this.value)">
                <option value="January">January</option>
                <option value="February">February</option>
                <option value="March">March</option>
                <option value="April">April</option>
                <option value="May">May</option>
                <option value="June">June</option>
                <option value="July">July</option>
                <option value="August">August</option>
                <option value="September">September</option>
                <option value="October">October</option>
                <option value="November">November</option>
                <option value="December">December</option>
            </select>
        </div>

        <div class="chart-container">
            <canvas id="myPieChart"></canvas>
        </div>
        
        <div class="button-container">
            <a href="wallet.html" class="return-button">Return to Wallet</a>
            <a href="home.html" class="return-button">Return to Home Page</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const initialData = {
            labels: ['Housing', 'Transportation', 'Food', 'Entertainment', 'Utilities', 'Other'],
            datasets: [{
                label: 'Spending Breakdown',
                data: [30, 20, 15, 10, 10, 15],
                backgroundColor: [
                    '#f7a8a8',
                    '#f27c7c',
                    '#ee5b5b',
                    '#ff9999',
                    '#ff6666',
                    '#ff3333'
                ],
                borderWidth: 1
            }]
        };

        let myPieChart;

        function updateChart(data) {
            const ctx = document.getElementById('myPieChart').getContext('2d');
            if (myPieChart) {
                myPieChart.data = data;
                myPieChart.update();
            } else {
                myPieChart = new Chart(ctx, {
                    type: 'pie',
                    data: data,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'right',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(tooltipItem) {
                                        return tooltipItem.label + ': ' + tooltipItem.raw.toFixed(2) + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        function updateValue(id) {
            const valueSpan = document.getElementById(`${id}-value`);
            const slider = document.getElementById(id);
            valueSpan.textContent = slider.value;
            updateSpendingValues();
        }

        function updateSpendingValues() {
            const totalAmount = parseFloat(document.getElementById('totalAmount').value);
            if (isNaN(totalAmount) || totalAmount <= 0) return;

            const housing = parseFloat(document.getElementById('housing').value);
            const transportation = parseFloat(document.getElementById('transportation').value);
            const food = parseFloat(document.getElementById('food').value);
            const entertainment = parseFloat(document.getElementById('entertainment').value);
            const utilities = parseFloat(document.getElementById('utilities').value);
            const other = parseFloat(document.getElementById('other').value);

            const totalPercentage = housing + transportation + food + entertainment + utilities + other;

            if (totalPercentage === 100) {
                const spendingData = {
                    labels: ['Housing', 'Transportation', 'Food', 'Entertainment', 'Utilities', 'Other'],
                    datasets: [{
                        label: 'Spending Breakdown',
                        data: [
                            (housing / 100) * totalAmount,
                            (transportation / 100) * totalAmount,
                            (food / 100) * totalAmount,
                            (entertainment / 100) * totalAmount,
                            (utilities / 100) * totalAmount,
                            (other / 100) * totalAmount
                        ],
                        backgroundColor: [
                            '#f7a8a8',
                            '#f27c7c',
                            '#ee5b5b',
                            '#ff9999',
                            '#ff6666',
                            '#ff3333'
                        ],
                        borderWidth: 1
                    }]
                };
                updateChart(spendingData);
            }
        }

        function saveSpendingData(month, totalAmount, housing, transportation, food, entertainment, utilities, other) {
            const spendingData = {
                month: month,
                totalAmount: totalAmount,
                housing: housing,
                transportation: transportation,
                food: food,
                entertainment: entertainment,
                utilities: utilities,
                other: other
            };

            localStorage.setItem(month, JSON.stringify(spendingData));
        }

        function loadSpendingData(month) {
            const spendingData = localStorage.getItem(month);
            if (spendingData) {
                const data = JSON.parse(spendingData);
                document.getElementById('totalAmount').value = data.totalAmount;
                document.getElementById('housing').value = data.housing;
                document.getElementById('transportation').value = data.transportation;
                document.getElementById('food').value = data.food;
                document.getElementById('entertainment').value = data.entertainment;
                document.getElementById('utilities').value = data.utilities;
                document.getElementById('other').value = data.other;

                updateValue('housing');
                updateValue('transportation');
                updateValue('food');
                updateValue('entertainment');
                updateValue('utilities');
                updateValue('other');

                updateSpendingValues();
            }
        }

        document.getElementById('spendingForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const month = document.getElementById('month').value;
            const totalAmount = parseFloat(document.getElementById('totalAmount').value);
            const housing = parseInt(document.getElementById('housing').value);
            const transportation = parseInt(document.getElementById('transportation').value);
            const food = parseInt(document.getElementById('food').value);
            const entertainment = parseInt(document.getElementById('entertainment').value);
            const utilities = parseInt(document.getElementById('utilities').value);
            const other = parseInt(document.getElementById('other').value);

            const total = housing + transportation + food + entertainment + utilities + other;

            if (total === 100) {
                saveSpendingData(month, totalAmount, housing, transportation, food, entertainment, utilities, other);
                updateSpendingValues();
            } else {
                console.log('Percentages must add up to 100%. Please adjust your values.');
            }
        });

        updateChart(initialData);

        const initialMonth = document.getElementById('month').value;
        loadSpendingData(initialMonth);
    </script>

</body>
</html>
